<!DOCTYPE html>
<html>

<head>
    <title>Data Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
    <style>
        body,
        html,
        #timeseriesPlot {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>

    <div id="timeseriesPlot"></div>

    <script>
        // Parse CSV string
        Papa.parse('https://thechesirecat.github.io/recTrack/output.csv', {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function (results) {
                var data = results.data;

                // Group data by location
                var dataByLocation = {};
                var minDate = new Date();
                var maxDate = new Date(0);
                data.forEach(function (row) {
                    row.updated = new Date(row.updated);  // Convert to Date
                    if (!(row.location_name in dataByLocation)) {
                        dataByLocation[row.location_name] = [];
                    }
                    dataByLocation[row.location_name].push(row);

                    if (row.updated < minDate) {
                        minDate = row.updated;
                    }
                    if (row.updated > maxDate) {
                        maxDate = row.updated;
                    }
                });

                // Prepare data for Plotly
                var traces = Object.keys(dataByLocation).map(function (location) {
                    return {
                        x: dataByLocation[location].map(row => row.updated),
                        y: dataByLocation[location].map(row => row.last_count),
                        mode: 'lines',
                        type: 'scatter',
                        name: location
                    };
                });
                minDate = new Date("2023-07-19T18:50:00");
                var layout = {
                    title: 'Last Count Timeseries by Location',
                    xaxis: {
                        range: [minDate, maxDate],
                        type: 'date'
                    },
                    yaxis: {
                        type: 'linear',
                        autorange: true
                    }
                };
                console.log([minDate, maxDate]);

                // Plot data
                Plotly.newPlot('timeseriesPlot', traces, layout);
            }
        });
    </script>

</body>

</html>