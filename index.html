<!DOCTYPE html>
<html>
<head>
    <title>Data Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
</head>
<body>

<div id="timeseriesPlot"></div>

<script>
// Parse CSV string
Papa.parse('https://thechesirecat.github.io/recTrack/output.csv', {
    download: true,
    header: true,
    dynamicTyping: true,
    complete: function(results) {
        var data = results.data;

        // Group data by location
        var dataByLocation = {};
        data.forEach(function(row) {
            if (!(row.location_name in dataByLocation)) {
                dataByLocation[row.location_name] = [];
            }
            dataByLocation[row.location_name].push(row);
        });

        // Prepare data for Plotly
        var traces = Object.keys(dataByLocation).map(function(location) {
            return {
                x: dataByLocation[location].map(row => new Date(row.timestamp_scrape)),
                y: dataByLocation[location].map(row => row.last_count),
                mode: 'lines',
                type: 'scatter',
                name: location
            };
        });

        var layout = {
            title: 'Percentage Timeseries by Location'
        };

        // Plot data
        Plotly.newPlot('timeseriesPlot', traces, layout);
    }
});
</script>

</body>
</html>
